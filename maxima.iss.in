;;----------------------------------------------------------------;;
;; -- maxima.iss --  Maxima InnoSetup installation script         ;;
;;----------------------------------------------------------------;;
;;                                                                ;;
;;  * InnoSetup version 5.1.7 or above is recommended             ;;
;;                                                                ;;
;;  * IMPORTANT!                                                  ;;
;;    Section [CustomMessages] below contains messages            ;;
;;    in several 8-bit encodings (code pages 1251, 1252).         ;;
;;    Don't use any encoding conversion tool (e.g. iconv,         ;;
;;    recode) on this file directly!                              ;;
;;                                                                ;;
;;----------------------------------------------------------------;;


[Setup]
AppName=Maxima
AppVerName=Maxima @VERSION@
AppId=Maxima-@VERSION@
UsePreviousAppDir=no
AppPublisher=The Maxima Development Team
AppPublisherURL=http://maxima.sourceforge.net
AppSupportURL=http://maxima.sourceforge.net
AppUpdatesURL=http://maxima.sourceforge.net
AppVersion=@VERSION@
OutputBaseFilename=maxima-@VERSION@
DefaultDirName={pf}\Maxima-@VERSION@
DefaultGroupName=Maxima-@VERSION@
InfoBeforeFile=interfaces\xmaxima\win32\InfoBefore.txt
InfoAfterFile=interfaces\xmaxima\win32\readme_en.txt
AllowNoIcons=yes
LicenseFile=@prefix@\share\maxima\@VERSION@\doc\COPYING
Compression=lzma/ultra
SolidCompression=yes
Uninstallable=yes
UninstallFilesDir={app}\uninst
ShowLanguageDialog=yes


[Languages]
Name: "en"; MessagesFile: "compiler:Default.isl"
Name: "fr"; MessagesFile: "compiler:Languages\French.isl"; InfoBeforeFile: "interfaces\xmaxima\win32\InfoBefore_fr.txt"; InfoAfterFile: "interfaces\xmaxima\win32\readme_fr.txt"
Name: "de"; MessagesFile: "compiler:Languages\German.isl"; InfoBeforeFile: "interfaces\xmaxima\win32\InfoBefore_de.txt"; InfoAfterFile: "interfaces\xmaxima\win32\readme_de.txt"
Name: "it"; MessagesFile: "compiler:Languages\Italian.isl"; InfoBeforeFile: "interfaces\xmaxima\win32\InfoBefore_it.txt"; InfoAfterFile: "interfaces\xmaxima\win32\readme_it.txt"
Name: "es"; MessagesFile: "compiler:Languages\Spanish.isl"; InfoBeforeFile: "interfaces\xmaxima\win32\InfoBefore_es.txt"; InfoAfterFile: "interfaces\xmaxima\win32\readme_es.txt"
Name: "pt_BR"; MessagesFile: "compiler:Languages\BrazilianPortuguese.isl"; InfoBeforeFile: "interfaces\xmaxima\win32\InfoBefore.txt"; InfoAfterFile: "interfaces\xmaxima\win32\readme_en.txt"
Name: "pt"; MessagesFile: "compiler:Languages\Portuguese.isl"; InfoBeforeFile: "interfaces\xmaxima\win32\InfoBefore_pt.txt"; InfoAfterFile: "interfaces\xmaxima\win32\readme_pt.txt"
Name: "ru"; MessagesFile: "compiler:Languages\Russian.isl"; InfoBeforeFile: "interfaces\xmaxima\win32\InfoBefore_ru.txt"; InfoAfterFile: "interfaces\xmaxima\win32\readme_ru.txt"


[Types] 
Name: "full"; Description: "{cm:FullInstallation}" 
Name: "compact"; Description: "{cm:CompactInstallation}" 
Name: "custom"; Description: "{cm:CustomInstallation}"; Flags: iscustom


[Components]
Name: "core"; Description: "{cm:MaximaCore}"; Types: full compact custom; Flags: fixed
Name: "wxmaxima"; Description: "{cm:wxMaximaGraphicShell}"; Types: full custom
Name: "xmaxima"; Description: "{cm:XMaximaGraphicShell}"; Types: full custom
Name: "lang"; Description: "{cm:MaximaLanguagePacks}"; Types: full custom
Name: "lang\spanish"; Description: "{cm:Spanish}"; Types: full custom
Name: "lang\portuguese"; Description: "{cm:Portuguese}"; Types: full custom


[Tasks]
Name: "wxmdesktopicon"; Description: "{cm:CreateMyDesktopIcon,wxMaxima}"; GroupDescription: "{cm:AdditionalIcons}"; MinVersion: 4,4;  Components: "wxmaxima"
Name: "xmdesktopicon"; Description: "{cm:CreateMyDesktopIcon,XMaxima}"; GroupDescription: "{cm:AdditionalIcons}"; Flags: unchecked; MinVersion: 4,4;  Components: "xmaxima"


[Files]
; core
Source: "@prefix@\bin\maxima-command.ico"; DestDir: "{app}\bin\"; Flags: ignoreversion; Components: "core"
Source: "@prefix@\bin\maxima.bat"; DestDir: "{app}\bin\"; Flags: ignoreversion; AfterInstall: ReplaceApp(); Components: "core" 
Source: "@prefix@\readme_*.txt"; DestDir: "{app}"; Components: "core"
Source: "@prefix@\*.*"; Excludes: "\bin\xmaxima.*,\bin\xmaxima,\wxMaxima,\info,\share\maxima\@VERSION@\doc\html,\share\maxima\@VERSION@\doc\chm"; DestDir: "{app}\";  Flags: recursesubdirs; Components: "core"
Source: "@prefix@\share\maxima\@VERSION@\doc\html\intromax.html"; DestDir: "{app}\share\maxima\@VERSION@\doc\html\"; Flags: ignoreversion; Components: "core"
Source: "@prefix@\share\maxima\@VERSION@\doc\chm\maxima.chm"; DestDir: "{app}\share\maxima\@VERSION@\doc\chm\"; Flags: ignoreversion; Components: "core"
Source: "@prefix@\info\*.*"; DestDir: "{app}\info\";  Flags: ignoreversion;  Components: "core"

; wmaxima
Source: "@prefix@\wxMaxima\*.*"; DestDir: "{app}\wxMaxima\"; Flags: ignoreversion recursesubdirs; Components: "wxmaxima"

; xmaxima
Source: "@prefix@\bin\xmaxima.*"; DestDir: "{app}\bin\"; Flags: ignoreversion; Components: "xmaxima"
Source: "@prefix@\bin\xmaxima"; DestDir: "{app}\bin\"; Flags: ignoreversion; Components: "xmaxima"

; lang\spanish
Source: "@prefix@\info\es\*.*"; DestDir: "{app}\info\es\";  Flags: recursesubdirs;  Components: "lang\spanish"
Source: "@prefix@\share\maxima\@VERSION@\doc\chm\es\maxima.chm"; DestDir: "{app}\share\maxima\@VERSION@\doc\chm\es\"; Components: "lang\spanish"
; lang\portuguese
Source: "@prefix@\info\pt\*.*"; DestDir: "{app}\info\pt\";  Flags: recursesubdirs;  Components: "lang\portuguese"
Source: "@prefix@\share\maxima\@VERSION@\doc\chm\pt\maxima.chm"; DestDir: "{app}\share\maxima\@VERSION@\doc\chm\pt\"; Components: "lang\portuguese"


[Icons]
; core
Name: "{group}\{cm:CommandLineMaxima}"; Filename: "{app}\bin\maxima.bat"; IconFilename: "{app}\bin\maxima-command.ico";  Components: "core"
Name: "{group}\{cm:Introduction}"; Filename: "{app}\share\maxima\@VERSION@\doc\html\intromax.html"; WorkingDir: "{app}\share\maxima\@VERSION@";  Components: "core"
Name: "{group}\{cm:ReferenceManual}"; Filename: "{app}\share\maxima\@VERSION@\doc\chm\maxima.chm"; WorkingDir: "{app}\share\maxima\@VERSION@";  Components: "core"
Name: "{group}\{cm:ReadmeMenuEntry}"; Filename: "{app}\readme_{language}.txt"; Components: "core"

; wxmaxima
Name: "{group}\wxMaxima"; Filename: "{app}\wxMaxima\wxMaxima.exe"; WorkingDir: "{app}\wxMaxima";  Components: "wxmaxima"
Name: "{group}\{cm:ProgramOnTheWeb,wxMaxima}"; Filename: "{app}\wxMaxima\wxMaxima.url";  Components: "wxmaxima"
Name: "{group}\{cm:OnlineForum,wxMaxima}"; Filename: "{app}\wxMaxima\Forum.url";  Components: "wxmaxima"
Name: "{userdesktop}\wxMaxima"; Filename: "{app}\wxMaxima\wxMaxima.exe"; MinVersion: 4,4; Tasks: wxmdesktopicon; WorkingDir: "{app}\wxMaxima";  Components: "wxmaxima"

; xmaxima
Name: "{group}\XMaxima"; Filename: "{app}\bin\xmaxima.exe"; IconFilename: "{app}\share\maxima\@VERSION@\xmaxima\maxima-icon.ico";  Components: "xmaxima"
Name: "{userdesktop}\XMaxima"; Filename: "{app}\bin\xmaxima.exe"; MinVersion: 4,4; Tasks: xmdesktopicon; IconFilename: "{app}\share\maxima\@VERSION@\xmaxima\maxima-icon.ico";  Components: "xmaxima"

Name: "{group}\{cm:Uninstall}"; Filename:"{uninstallexe}"

; lang\spanish
Name: "{group}\{cm:ReferenceManualSpanish}"; Filename: "{app}\share\maxima\@VERSION@\doc\chm\es\maxima.chm"; WorkingDir: "{app}\share\maxima\@VERSION@";  Components: "lang\spanish"
; lang\portuguese
Name: "{group}\{cm:ReferenceManualPortuguese}"; Filename: "{app}\share\maxima\@VERSION@\doc\chm\pt\maxima.chm"; WorkingDir: "{app}\share\maxima\@VERSION@";  Components: "lang\portuguese"


;[Run]
;Filename: "{app}\bin\xmaxima.exe"; Description: "{cm:LaunchProgram,XMaxima}"; Flags: postinstall skipifsilent skipifdoesntexist
;Filename: "{app}\wxMaxima\wxMaxima.exe"; Description: "{cm:LaunchProgram,wxMaxima}"; Flags: postinstall skipifsilent skipifdoesntexist


[CustomMessages]


;=== English ===  LID=$0409  CodePage=0

FullInstallation=Full installation
CompactInstallation=Compact installation
CustomInstallation=Custom istalation
Uninstall=Uninstall

MaximaCore=Maxima core with command line interface
wxMaximaGraphicShell=wxMaxima graphic shell
XMaximaGraphicShell=XMaxima graphic shell
MaximaLanguagePacks=Maxima language packs

German=German
French=French
Italian=Italian
Portuguese=Portuguese
Russian=Russian
Spanish=Spanish

CreateMyDesktopIcon=Create %1 desktop icon

CommandLineMaxima=Command line Maxima
Introduction=Introduction
ReferenceManual=Reference Manual
Readme=README
ReadmeMenuEntry=README

OnlineForum=%1 Online Forum

ReferenceManualGerman=Reference Manual (German)
ReferenceManualFrench=Reference Manual (French)
ReferenceManualItalian=Reference Manual (Italian)
ReferenceManualPortuguese=Reference Manual (Portuguese)
ReferenceManualRussian=Reference Manual (Russian)
ReferenceManualSpanish=Reference Manual (Spanish)


;=== German ===  LID=$0407  CodePage=1252

de.FullInstallation=Vollständige Installation
de.CompactInstallation=Kompakte Installation
de.CustomInstallation=Benutzerdefinierte Installation
de.Uninstall=Deinstallation

de.MaximaCore=Maxima-Programmkern mit Eingabeaufforderung 
de.wxMaximaGraphicShell=wxMaxima (graphische Oberfläche)
de.XMaximaGraphicShell=XMaxima (graphische Oberfläche)
de.MaximaLanguagePacks=Maxima-Sprachpakete

de.German=Deutsch
de.French=Französich
de.Italian=Italienisch
de.Portuguese=Portugiesisch
de.Russian=Russisch
de.Spanish=Spanisch

de.CreateMyDesktopIcon=Erzeuge %1-Desktopsymbol

de.CommandLineMaxima=Maxima-Eingabeaufforderung
de.Introduction=Einführung
de.ReferenceManual=Referenzhandbuch
de.Readme=LIESMICH
de.ReadmeMenuEntry=LIESMICH

de.OnlineForum=%1-Online-Forum

de.ReferenceManualGerman=Referenzhandbuch (Deutsch)
de.ReferenceManualFrench=Referenzhandbuch (Französich)
de.ReferenceManualItalian=Referenzhandbuch (Italienisch)
de.ReferenceManualPortuguese=Referenzhandbuch (Portugiesisch)
de.ReferenceManualRussian=Referenzhandbuch (Russisch)
de.ReferenceManualSpanish=Referenzhandbuch (Spanisch)


;=== French ===  LID=$040C  CodePage=1252

fr.FullInstallation=Installation complète
fr.CompactInstallation=Installation compacte
fr.CustomInstallation=Installation personnalisée
fr.Uninstall=Désinstallation

fr.MaximaCore=Noyau Maxima avec interface en ligne de commande
fr.wxMaximaGraphicShell=Interface graphique wxMaxima
fr.XMaximaGraphicShell=Interface graphique XMaxima
fr.MaximaLanguagePacks=Paquets de langues Maxima

fr.German=Allemagne
fr.French=French
fr.Italian=Italy
fr.Portuguese=Portugal
fr.Russian=Russie
fr.Spanish=Espagne

fr.CreateMyDesktopIcon=Créer un raccourci sur le bureau pour %1

fr.CommandLineMaxima=Ligne de commande Maxima
fr.Introduction=Introduction
fr.ReferenceManual=Manuel de référence
fr.Readme=LISEZMOI
fr.ReadmeMenuEntry=README

fr.OnlineForum=Forum en ligne %1

fr.ReferenceManualGerman=Manuel de référence (Allemand)
fr.ReferenceManualFrench=Manuel de référence (Français)
fr.ReferenceManualItalian=Manuel de référence (Italien)
fr.ReferenceManualPortuguese=Manuel de référence (Portugais)
fr.ReferenceManualRussian=Manuel de référence (Russe)
fr.ReferenceManualSpanish=Manuel de référence (Espagnol)


;=== Italian ===  LID=$0410  CodePage=1252

it.FullInstallation=Installazione completa
it.CompactInstallation=Installazione compatta
it.CustomInstallation=Installazione personalizzata
it.Uninstall=Disinstallazione

it.MaximaCore=Nucleo di Maxima con interfaccia a riga di comando
it.wxMaximaGraphicShell=Shell grafica wxMaxima
it.XMaximaGraphicShell=Shell grafica XMaxima
it.MaximaLanguagePacks=Pacchetti lingua di Maxima

it.Germen=Tedesco
it.French=Francese
it.Italian=Italiano
it.Portuguese=Portoghese
it.Russian=Russo
it.Spanish=Spagnolo

it.CreateMyDesktopIcon=Crea %1 icona sul desktop

it.CommandLineMaxima=Maxima a riga di comando
it.Introduction=Introduzione
it.ReferenceManual=Manuale di riferimento
it.Readme=LEGGIMI
it.ReadmeMenuEntry=LEGGIMI

it.OnlineForum=%1 Forum online

it.ReferenceManualGerman=Manuale di Riferimento (Tedesco)
it.ReferenceManualFrench=Manuale di Riferimento (Francese)
it.ReferenceManualItalian=Manuale di Riferimento (Italiano)
it.ReferenceManualPortuguese=Manuale di Riferimento (Portoghese)
it.ReferenceManualRussian=Manuale di Riferimento (Russo)
it.ReferenceManualSpanish=Manuale di Riferimento (Spagnolo)


;=== Portuguese (Brazilian) ===  LID=$0416  CodePage=1252

pt_BR.FullInstallation=Full installation
pt_BR.CompactInstallation=Compact installation
pt_BR.CustomInstallation=Custom istalation
pt_BR.Uninstall=Uninstall

pt_BR.MaximaCore=Maxima core with command line interface
pt_BR.wxMaximaGraphicShell=wxMaxima graphic shell
pt_BR.XMaximaGraphicShell=XMaxima graphic shell
pt_BR.MaximaLanguagePacks=Maxima language packs

pt_BR.German=German
pt_BR.French=French
pt_BR.Italian=Italian
pt_BR.Portuguese=Portuguese
pt_BR.Russian=Russian
pt_BR.Spanish=Spanish

pt_BR.CreateMyDesktopIcon=Create %1 desktop icon

pt_BR.CommandLineMaxima=Command line Maxima
pt_BR.Introduction=Introduction
pt_BR.ReferenceManual=Reference Manual
pt_BR.Readme=README
pt_BR.ReadmeMenuEntry=README

pt_BR.OnlineForum=%1 Online Forum

pt_BR.ReferenceManualGerman=Reference Manual (German)
pt_BR.ReferenceManualFrench=Reference Manual (French)
pt_BR.ReferenceManualItalian=Reference Manual (Italian)
pt_BR.ReferenceManualPortuguese=Reference Manual (Portuguese)
pt_BR.ReferenceManualRussian=Reference Manual (Russian)
pt_BR.ReferenceManualSpanish=Reference Manual (Spanish)


;=== Portuguese ===  LID=$0816  CodePage=1252

pt.FullInstallation=InstalaÃ§Ã£o completa
pt.CompactInstallation=InstalaÃ§Ã£o compacta
pt.CustomInstallation=InstalaÃ§Ã£o personalizada
pt.Uninstall=Desinstalar

pt.MaximaCore=NÃºcleo do Maxima com interface de linha de comandos
pt.wxMaximaGraphicShell=shell grÃ¡fica wxMaxima
pt.XMaximaGraphicShell=shell grÃ¡fica XMaxima
pt.MaximaLanguagePacks=pacotes linguÃ­sticas do Maxima

pt.German=AlemÃ£o
pt.French=FrancÃªs
pt.Italian=Italiano
pt.Portuguese=PortuguÃªs
pt.Russian=Russo
pt.Spanish=Espanhol

pt.CreateMyDesktopIcon=Criar Ã­cone no escritÃ³rio para %1

pt.CommandLineMaxima=Maxima em Linha de Comandos
pt.Introduction=IntroduÃ§Ã£o 
pt.ReferenceManual=Manual de ReferÃªncia
pt.Readme=LEIAME
pt.ReadmeMenuEntry=LEIAME

pt.OnlineForum=FÃ³rum na rede para %1

pt.ReferenceManualGerman=Manual de ReferÃªncia (AlemÃ£o)
pt.ReferenceManualFrench=Manual de ReferÃªncia (FrancÃªs)
pt.ReferenceManualItalian=Manual de ReferÃªncia (Italiano)
pt.ReferenceManualPortuguese=Manual de ReferÃªncia (PortuguÃªs)
pt.ReferenceManualRussian=Manual de ReferÃªncia (Russo)
pt.ReferenceManualSpanish=Manual de ReferÃªncia (Espanhol)


;=== Russian ===  LID=$0419  CodePage=1251

ru.FullInstallation=Ïîëíàÿ óñòàíîâêà
ru.CompactInstallation=Êîìïàêòíàÿ óñòàíîâêà
ru.CustomInstallation=Âûáîðî÷íàÿ óñòàíîâêà
ru.Uninstall=Äåèíñòàëëÿöèÿ

ru.MaximaCore=ßäðî Maxima ñ èíòåðôåéñîì êîìàíäíîé ñòðîêè
ru.wxMaximaGraphicShell=Ãðàôè÷åñêàÿ îáîëî÷êà wxMaxima
ru.XMaximaGraphicShell=Ãðàôè÷åñêàÿ îáîëî÷êà XMaxima
ru.MaximaLanguagePacks=Ïàêåòû ïîääåðæêè ÿçûêîâ Maxima

ru.German=Íåìåöêèé
ru.French=Ôðàíöóçñêèé
ru.Italian=Èòàëüÿíñêèé
ru.Portuguese=Ïîðòóãàëüñêèé
ru.Russian=Ðóññêèé
ru.Spanish=Èñïàíñêèé

ru.CreateMyDesktopIcon=Ñîçäàòü çíà÷åê %1 íà ðàáî÷åì ñòîëå

ru.CommandLineMaxima=Maxima â êîìàíäíîé ñòðîêå
ru.Introduction=Ââåäåíèå
ru.ReferenceManual=Ñïðàâî÷íîå ðóêîâîäñòâî
ru.Readme=README
ru.ReadmeMenuEntry=README

ru.OnlineForum=Ôîðóì %1

ru.ReferenceManualGerman=Ñïðàâî÷íîå ðóêîâîäñòâî (Íåìåöêèé)
ru.ReferenceManualFrench=Ñïðàâî÷íîå ðóêîâîäñòâî (Ôðàíöóçñêèé)
ru.ReferenceManualItalian=Ñïðàâî÷íîå ðóêîâîäñòâî (Èòàëüÿíñêèé)
ru.ReferenceManualPortuguese=Ñïðàâî÷íîå ðóêîâîäñòâî (Ïîðòóãàëüñêèé)
ru.ReferenceManualRussian=Ñïðàâî÷íîå ðóêîâîäñòâî (Ðóññêèé)
ru.ReferenceManualSpanish=Ñïðàâî÷íîå ðóêîâîäñòâî (Èñïàíñêèé)


;=== Spanish ===  LID=$0c0a  CodePage=1252

es.FullInstallation=Instalación Completa
es.CompactInstallation=Instalación Compacta
es.CustomInstallation=Instalación Personalizada
es.Uninstall=Desinstalar

es.MaximaCore=Núcleo de Maxima e interfaz de línea de comandos
es.wxMaximaGraphicShell=Entorno gráfico wxMaxima
es.XMaximaGraphicShell=Entorno gráfico XMaxima
es.MaximaLanguagePacks=Internacionalización de Maxima

es.German=Alemán
es.French=Francés
es.Italian=Italiano
es.Portuguese=Portugués
es.Russian=Ruso
es.Spanish=Español

es.CreateMyDesktopIcon=Crear icono de escritorio

es.CommandLineMaxima=Línea de comandos de Maxima
es.Introduction=Introducción
es.ReferenceManual=Manual de Referencia
es.Readme=LEAME
es.ReadmeMenuEntry=LEAME

es.OnlineForum=Foro en línea para %1

es.ReferenceManualGerman=Manual de Referencia (Alemán)
es.ReferenceManualFrench=Manual de Referencia (Francés)
es.ReferenceManualItalian=Manual de Referencia (Italiano)
es.ReferenceManualPortuguese=Manual de Referencia (Portugués)
es.ReferenceManualRussian=Manual de Referencia (Ruso)
es.ReferenceManualSpanish=Manual de Referencia (Español)

;=============


[Code]

{ Check if a path contains spaces.  If it does, convert it to
  the equivalent short path }
function PathWithoutSpaces( strIn: String): String;
begin
  if (Pos(' ',strIn) = 0) then
    Result := strIn
  else
    Result := GetShortName(strIn);
end;


{ Based on code from Inno Setup Extensions Knowledge Base
  Article 14 - How to replace a line in a text file
  http://www13.brinkster.com/vincenzog/isxart.asp?idart=14
  Author: Stefan Bracke }

{ Note: Functions called by AfterInstall can have maximum of one argument }

procedure ReplaceApp();
var
  iLineCounter : Integer;
  a_strTextfile : TArrayOfString;
  strFilename : String;
  strFind : String;
  strNewLine : String;
  strApp : String;
begin
  strApp := ExpandConstant('{app}');
  strFilename := strApp + '\bin\maxima.bat';
  strFind := 'set maxima_prefix';
  strNewLine := 'set maxima_prefix='+PathWithoutSpaces(strApp);
  
  { Load textfile into string array }
  LoadStringsFromFile(strFilename, a_strTextfile);
  
  { Search through all textlines for given text }
  for iLineCounter := 0 to GetArrayLength(a_strTextfile)-1 do
    begin
      { Overwrite textline when text searched for is part of it }
      if (Pos(strFind, a_strTextfile[iLineCounter]) > 0) then
        a_strTextfile[iLineCounter] := strNewLine;
    end;

  { Save string array to textfile (overwrite, no append!) }
  SaveStringsToFile(strFilename, a_strTextfile, False);

end;

