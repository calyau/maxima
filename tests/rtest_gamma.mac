/******************************************************************************
  rtest_gamma.mac
  Test for Factorial, Gamma function and related functions ...
******************************************************************************/

kill(all);
done;

(oldfpprec:fpprec, fpprec:16, done);
done;

/* Two definitions for numerical test functions
   For big results relerror is used */

(closeto(value,compare,tol):=
  block(
    [abse],
    abse:abs(value-compare),if(abse<tol) then true else abse),
    done);
done;

(relerror(value,compare,tol):=
  block(
    [abse],
    abse:abs((value-compare)/compare),
    if(abse<tol) then true else abse),
    done);
done;

/******************************************************************************
  Factorial
******************************************************************************/

/* Factorial has mirror symmetrie */

declare(z,complex);
done;

conjugate(factorial(z));
factorial(conjugate(z));

conjugate(factorial(x+%i*y));
factorial(x-%i*y);

/* some small positive integers or the real representation */

fpprec:16;
16;

map(factorial, [0,1,2,3,4]);
[1,1,2,6,24];

closeto(factorial(0.0),1.0,1e-13);
true;
closeto(factorial(1.0),1.0,1e-13);
true;
closeto(factorial(2.0),2.0,1e-13);
true;
closeto(factorial(3.0),6.0,1e-13);
true;
closeto(factorial(4.0),24.0,1e-13);
true;

closeto(factorial(0.0b0),1.0b0,1e-13);
true;
closeto(factorial(1.0b0),1.0b0,1e-13);
true;
closeto(factorial(2.0b0),2.0b0,1e-13);
true;
closeto(factorial(3.0b0),6.0b0,1e-13);
true;
closeto(factorial(4.0b0),24.0b0,1e-13);
true;

/* negatvie integers or there real representation */

errcatch(factorial(-1));
[];

errcatch(factorial(-1.0));
[];

errcatch(factorial(-1.0b0));
[];

errcatch(factorial(-10));
[];

errcatch(factorial(-10.0));
[];

errcatch(factorial(-10.0b0));
[];

/* half integral values */

factorial(1/2);
sqrt(%pi)/2;
factorial(-1/2);
sqrt(%pi);
factorial(3/2);
3*sqrt(%pi)/4;
factorial(-3/2);
-2*sqrt(%pi);
factorial(5/2);
15*sqrt(%pi)/8;
factorial(-5/2);
4*sqrt(%pi)/3;

/* Expansion for factorial(z+n) and integer n */

factorial_expand:true;
true;

factorial(z+1);
(z+1)*factorial(z);

factorial(z+2);
(z+1)*(z+2)*factorial(z);

factorial(z+3);
(z+1)*(z+2)*(z+3)*factorial(z);

factorial(z-1);
factorial(z)/z;

factorial(z-1);
factorial(z)/z;

factorial(z-2);
factorial(z)/(z*(z-1));

factorial(z-3);
factorial(z)/(z*(z-1)*(z-2));

/* Nested factorials simplifies too, see SF[1486452] */

factorial(factorial(n)/factorial(n-1));
factorial(n);

factorial(sin(factorial(n)/factorial(n-1)));
factorial(sin(n));

factorial_expand:false;
false;

/* minfactorial does not do this job */

minfactorial(factorial(factorial(n)/factorial(n-1)));
factorial(factorial(n)/factorial(n-1));

/* factcomb is the inverse operation to minfactorial 
   factorial_expand has to be false 
*/

factcomb((n+1)*(n+2)*(n+3)*n!);
(n+3)!;

factcomb(n!/(n*(n-1)*(n-2)));
(n-3)!;

/* No simplifcation for infinities and undeterminates 
   with the exception of inf: inf! -> inf */

map(factorial, [inf,minf,infinity,und,ind]);
[inf,factorial(minf),factorial(infinity),factorial(und),factorial(ind)];

/* factlim is set to the value 100,000. This should work.  */

fpprec:64;
64;

relerror(
  factorial(factlim),
  factorial(bfloat(factlim)),
  1b-58);                      /* We loose a lost of digits in relerror */
true;

factorial(factlim+1);
factorial(100000+1);

/* Some real values in double float and bigfloat precision */

fpprec:64;
64;

closeto(
  factorial(1.3),
  1.166711905198160345041881441202917938533994349719468893970206664b0,
  1e-14);
true;

closeto(
  factorial(2.3),
  2.683437381955768793596327314766711258628187004354778456131475327b0,
  1e-14);
true;

closeto(
  factorial(3.3),
  8.855343360454037018867880138730147153473017114370768905233868579b0,
  1e-14);
true;

closeto(
  factorial(1.3b0),
  1.166711905198160345041881441202917938533994349719468893970206664b0,
  1e-62);
true;

closeto(
  factorial(2.3b0),
  2.683437381955768793596327314766711258628187004354778456131475327b0,
  1e-62);
true;

closeto(
  factorial(3.3b0),
  8.855343360454037018867880138730147153473017114370768905233868579b0,
  1e-61);
true;

/* some complex values in double float and bigfloat precision */

closeto(
  factorial(1.3+%i),
  (0.7191409365372817791473038599462048083254863806205029128993808432b0 
  +0.5406144679098492753783510221774150545811250310680842509749769021b0*%i),
  1e-14);
true;

closeto(
  factorial(2.3+%i),
  (1.113409686125898816660447855698856004567493644359072448693599037b0 
  +1.962554212729935112517511210954259433862073952077096690141827718b0*%i),
  1e-14);
true;

closeto(
  factorial(3.3+%i),
  (1.711697751485530982461966712851965381210655074307842390547049105b0 
  +7.589838588134684687968234851847912136312337686213491526161630507b0*%i),
  5.0e-14);
true;

closeto(
  factorial(1.3b0+%i),
  (0.7191409365372817791473038599462048083254863806205029128993808432b0 
  +0.5406144679098492753783510221774150545811250310680842509749769021b0*%i),
  1e-62);
true;

closeto(
  factorial(2.3b0+%i),
  (1.113409686125898816660447855698856004567493644359072448693599037b0 
  +1.962554212729935112517511210954259433862073952077096690141827718b0*%i),
  1e-62);
true;

closeto(
  factorial(3.3b0+%i),
  (1.711697751485530982461966712851965381210655074307842390547049105b0 
  +7.589838588134684687968234851847912136312337686213491526161630507b0*%i),
  1e-61);
true;

/******************************************************************************
  General factorial: Tests for genfact(x,y,z)
******************************************************************************/

genfact(0,0,1);
1;
genfact(1,1,1);
1;
genfact(2,2,1);
2;
genfact(3,3,1);
6;
genfact(4,4,1);
24;

genfact(0,0/2,2);
1;
genfact(1,1/2,2);
1;
genfact(2,2/2,2);
2;
genfact(3,3/2,2);
3;
genfact(4,4/2,2);
8;

genfact(10,10,1);
3628800;
genfact(10,9,1);
3628800;
genfact(10,8,1);
1814400;
genfact(10,7,1);
604800;
genfact(10,6,1);
151200;
genfact(10,5,1);
30240;
genfact(10,4,1);
5040;
genfact(10,3,1);
720;
genfact(10,2,1);
90;
genfact(10,1,1);
10;
genfact(10,0,1);
1;

genfact(10,5,2);
3840;
genfact(10,4,2);
1920;
genfact(10,3,2);
480;
genfact(10,2,2);
80;
genfact(10,1,2);
10;
genfact(10,0,2);
1;

/* for non valid integers we get an error */
errcatch(genfact(-2,-2,1));
[];
errcatch(genfact(2,5,2));
[];

/* for all other numbers we get a noun form */
(3/2)!!;
genfact(3/2,0,2);
(2.5)!!;
genfact(2.5,1,2);
(2.5b0)!!;
genfact(2.5b0,1,2);

/******************************************************************************
  Double factorial
******************************************************************************/

/* Double factorial has mirror symmetry */

declare(z,complex);
done;

conjugate(double_factorial(z));
double_factorial(conjugate(z));

conjugate(double_factorial(x+%i*y));
double_factorial(x-%i*y);

/* No simplifcation for infinities and undeterminates 
   with the exception of inf: inf! -> inf */

map(factorial, [inf,minf,infinity,und,ind]);
[inf,factorial(minf),factorial(infinity),factorial(und),factorial(ind)];

/* Test the expansion of Double factorial */

double_factorial(n+1);
double_factorial(n+1);

double_factorial(n+2),factorial_expand:true;
(n+2)*double_factorial(n);

double_factorial(n+3),factorial_expand:true;
double_factorial(n+3);

double_factorial(n+4),factorial_expand:true;
(n+2)*(n+4)*double_factorial(n);

double_factorial(n-1),factorial_expand:true;
factorial(n)/double_factorial(n);

double_factorial(n-2),factorial_expand:true;
double_factorial(n)/n;

double_factorial(n-3),factorial_expand:true;
double_factorial(n-3);

double_factorial(n-4),factorial_expand:true;
double_factorial(n)/(n*(n-2));

/* Some small numbers */

double_factorial(-3);
-1;
errcatch(double_factorial(-2));
[];
double_factorial(-1);
1;
double_factorial(0);
1;
double_factorial(1);
1;
double_factorial(2);
2;
double_factorial(3);
3;
double_factorial(4);
8;
double_factorial(5);
15;
double_factorial(6);
48;
double_factorial(7);
105;
double_factorial(8);
384;
double_factorial(9);
945;
double_factorial(10);
3840;

/* The same for double float */

closeto(
  double_factorial(-3.0),
  -1.0,
  1e-13);
true;

errcatch(double_factorial(-2.0));
[];

closeto(
  double_factorial(-1.0),
  1.0,
  1e-13);
true;

closeto(
  double_factorial(0.0),
  1.0,
  1e-13);
true;

closeto(
  double_factorial(1.0),
  1.0,
  1e-13);
true;

closeto(
  double_factorial(2.0),
  2.0,
  1e-13);
true;

closeto(
  double_factorial(3.0),
  3.0,
  1e-13);
true;

closeto(
  double_factorial(4.0),
  8.0,
  1e-13);
true;

closeto(
  double_factorial(5.0),
  15.0,
  1e-13);
true;

closeto(
  double_factorial(6.0),
  48.0,
  1e-13);
true;

closeto(
  double_factorial(7.0),
  105.0,
  1e-13);
true;

closeto(
  double_factorial(8.0),
  384.0,
  1e-12);
true;

closeto(
  double_factorial(9.0),
  945.0,
  1e-11);
true;

closeto(
  double_factorial(10.0),
  3840.0,
  1.5E-12);
true;

/* The same with bigfloat */
fpprec:64;
64;

closeto(
  double_factorial(-3.0b0),
  -1.0b0,
  1e-13);
true;

errcatch(double_factorial(-2.0b0));
[];

closeto(
  double_factorial(-1.0b0),
  1.0b0,
  1e-13);
true;

closeto(
  double_factorial(0.0b0),
  1.0b0,
  1e-13);
true;

closeto(
  double_factorial(1.0b0),
  1.0b0,
  1e-13);
true;

closeto(
  double_factorial(2.0b0),
  2.0b0,
  1e-13);
true;

closeto(
  double_factorial(3.0b0),
  3.0b0,
  1e-13);
true;

closeto(
  double_factorial(4.0b0),
  8.0b0,
  1e-13);
true;

closeto(
  double_factorial(5.0b0),
  15.0b0,
  1e-13);
true;

closeto(
  double_factorial(6.0b0),
  48.0b0,
  1e-13);
true;

closeto(
  double_factorial(7.0b0),
  105.0b0,
  1e-13);
true;

closeto(
  double_factorial(8.0b0),
  384.0b0,
  1e-13);
true;

closeto(
  double_factorial(9.0b0),
  945.0b0,
  1e-13);
true;

closeto(
  double_factorial(10.0b0),
  3840.0b0,
  1e-13);
true;

/* Some real and complex values */

closeto(
  double_factorial(-3.5),
  -1.283770376595223397225456287264697304361344685971440894669095353b0,
  1e-13);
true;

closeto(
  double_factorial(-3.5b0),
  -1.283770376595223397225456287264697304361344685971440894669095353b0,
  1e-60);
true;

closeto(
  double_factorial(-3.5+%i),
  (-0.0026442534512730229977827874410755514695008373007370518369259413b0 
   +0.4140148090845355309500755922424659939330568167751526009311942842b0*%i),
  1e-13);
true;

closeto(
  double_factorial(3.5),
  4.832319386136852665658314936437452651454869331098044546829825309b0,
  1e-13);
true;

closeto(
  double_factorial(3.5b0),
  4.832319386136852665658314936437452651454869331098044546829825309b0,
  1e-60);
true;

closeto(
  double_factorial(3.5+%i),
  (-2.165793510810110416038389252512222520262890874310470919228355939b0 
   +4.032141259508464573377851775093179996368679285808989461893416849b0*%i),
  1e-13);
true;

closeto(
  double_factorial(-3.5b0+%i),
  (-0.0026442534512730229977827874410755514695008373007370518369259413b0 
   +0.4140148090845355309500755922424659939330568167751526009311942842b0*%i),
  1e-60);
true;

closeto(
  double_factorial(3.5b0+%i),
  (-2.165793510810110416038389252512222520262890874310470919228355939b0 
   +4.032141259508464573377851775093179996368679285808989461893416849b0*%i),
  1b-60);
true;

closeto(
  double_factorial(3.3b0+%i),
  (-0.401169963963553982868990904015984192029807700247132080411340721b0 
  + 1.778201955902329072861901606357849890890501421219437116360540910b0*%i),
  1b-60);
true;

/******************************************************************************

  Test the Gamma function

  Numerical values are taken from functions/wolfram.com.
******************************************************************************/

/* The Gamma function has mirror symmetry */

declare(z,complex);
done;

conjugate(gamma(z));
gamma(conjugate(z));

conjugate(gamma(x+%i*y));
gamma(x-%i*y);

/* Check some simple values for integer, float and bigfloat */

map('gamma,[1,2,3,4,5]);
[1,1,2,6,24];

closeto(gamma(1.0),1.0,1e-13);
true;

closeto(gamma(2.0),1.0,1e-13);
true;

closeto(gamma(3.0),2.0,1e-13);
true;

closeto(gamma(4.0),6.0,1e-13);
true;

closeto(gamma(5.0),24.0,5e-13);  
true;

closeto(gamma(1.0b0),1.0b0,1e-13);
true;

closeto(gamma(2.0b0),1.0b0,1e-13);
true;

closeto(gamma(3.0b0),2.0b0,1e-13);
true;

closeto(gamma(4.0b0),6.0b0,1e-13);
true;

closeto(gamma(5.0b0),24.0b0,1e-13);
true;

/* Check for a zero argument */

errcatch(gamma(0));
[];
errcatch(gamma(0.0));
[];
errcatch(gamma(0.0b0));
[];

/* Check test for negative integer or a representation of a negative integer */

errcatch(gamma(-2));
[];
errcatch(gamma(-2.0));
[];
errcatch(gamma(-2.b0));
[];

/* Check half integral integers as values */

gamma(1/2);
sqrt(%pi);
gamma(-1/2);
-2*sqrt(%pi);
gamma(3/2);
sqrt(%pi)/2;
gamma(-3/2);
4*sqrt(%pi)/3;
gamma(5/2);
3*sqrt(%pi)/4;
gamma(-5/2);
-8*sqrt(%pi)/15;

/* Check expansion of the Gamma function */

gamma_expand:true;
true;

gamma(z+1)/gamma(z);
z;

gamma(gamma(z+1)/gamma(z));
gamma(z);

gamma(z+1)/gamma(z-1);
(z-1)*z;

gamma(z+2)/gamma(z-2);
(z-2)*(z-1)*z*(z+1);

gamma_expand:false;
false;

/* We check that the default values for $factlim:100000 and 
   $gammalim:10000 work. */

fpprec:16;
16;

relerror(
  bfloat(gamma(factlim)),
  gamma(bfloat(factlim)),
  1b-14);
true;

relerror(
  bfloat(gamma((gammalim-1)+1/2)),
  gamma(bfloat((gammalim-1)+1/2)),
  1b-15);
true;

relerror(
  bfloat(gamma(-gammalim+1/2)),
  gamma(bfloat(-gammalim+1/2)),
  1b-15);
true;

/* Check test for overflow in flonum routine gamma-lanczos */

relerror(
  gamma(170.0),          /* should not overflow. For GCL 2.6.8 and */
  float(gamma(170)),     /* and CLISP 2.44 the limit is ~171.6243  */
  1e-12);
true;       

errcatch(gamma(175.0));  /* should overflow */
[];

errcatch(gamma(250.0));  /* should overflow */
[];

/* Simplifcation for infinities and undeterminates only for inf */

map('gamma, [inf,minf,infinity,und,ind]);
[inf,gamma(minf),gamma(infinity),gamma(und),gamma(ind)];

/* Check real and complex arguments in double float precision. 
   This is a check for the numerical routine gamma-lanczos */

closeto(
  gamma(1.5),
  0.8862269254527580136490837416705725913987747280611935641069038949b0,
  1e-14);
true;

closeto(
  gamma(2.5),
  1.329340388179137020473625612505858887098162092091790346160355842b0,
  1e-14);
true;

closeto(
  gamma(3.5),
  3.323350970447842551184064031264647217745405230229475865400889606b0,
  1e-14);
true;

relerror(
  gamma(75.5),
  2.859942315653572214189951793671955438617013849084406338093590075b108,
  5e-14);
true;

closeto(
  gamma(0.5+%i),
  (0.3006946172606558162173894638352104402306759641691949986162475934b0 
  -0.4249678794331238126098496402574059704734842223340586518754297249b0*%i),
  1e-14);
true;

closeto(
  gamma(1.5+%i),
  (0.5753151880634517207185443721750111905888222044186561511835535216b0 
  +0.0882106775440939099124646437065074549939338530021656726785327309b0*%i),
  1e-14);
true;

closeto(
  gamma(2.5+%i),
  (0.7747621045510836711653519145560093308892994536258185540967975514b0 
  +0.7076312043795925855872413377347723730797229839219046602013526179b0*%i),
  1e-14);
true;

closeto(
  gamma(3.5+%i),
  (1.229274056998116592326138448655250954143525650142641725040641261b0 
  +2.543840115500065135133455258892940263588606913430580204600179096b0*%i),
  1e-14);
true;

relerror(
  gamma(75.5+%i),
  (-1.092860022497734443706055997676557155572470037327121860702819811b108 
   -2.622326961675321010452173874453854546607804545768376326095021243b108*%i),
  5e-14);
true;

/* Check negative real arguments in double float precision. 
   This is a check for the reflection formula of gamma-lanzos */

closeto(
  gamma(-0.5),
  -3.544907701811032054596334966682290365595098912244774256427615580b0,
  1e-14);
true;

closeto(
  gamma(-1.5),
  2.363271801207354703064223311121526910396732608163182837618410386b0,
  1e-14);
true;

closeto(
  gamma(-2.5),
  -0.9453087204829418812256893244486107641586930432652731350473641546b0,
  1e-14);
true;

/* Check real arguments up to 64 digits. 
   This is a check for the numerical routine bffac */

fpprec:64; /* we have saved the actual value at the beginning of the file */
64;

closeto(
  gamma(0.5b0),
  1.772453850905516027298167483341145182797549456122387128213807790b0,
  5.0b-64);
true;

closeto(
  gamma(1.5b0),
  0.8862269254527580136490837416705725913987747280611935641069038949b0,
  5.0b-64);
true;

closeto(
  gamma(2.5b0),
  1.329340388179137020473625612505858887098162092091790346160355842b0,
  5.0b-64);
true;

closeto(
  gamma(3.5b0),
  3.323350970447842551184064031264647217745405230229475865400889606b0,
  5.0b-64);
true;

relerror(
  gamma(75.5b0),
  2.859942315653572214189951793671955438617013849084406338093590075b108,
  5.0b-64);
true;

/* Check negative real arguments up to 64 digits. 
   This is a check for the reflection formula of bffac */

closeto(
  gamma(-0.5b0),
  -3.544907701811032054596334966682290365595098912244774256427615580b0,
  5.0b-64);
true;

closeto(
  gamma(-1.5b0),
  2.363271801207354703064223311121526910396732608163182837618410386b0,
  8.0b-64);
true;

closeto(
  gamma(-2.5b0),
  -0.9453087204829418812256893244486107641586930432652731350473641546b0,
  5.0b-64);
true;

/* Check complex arguments up to 64 digits. 
   This is a check for the numerical routine cbffac */

closeto(
  gamma(0.5b0+%i),
  (0.3006946172606558162173894638352104402306759641691949986162475934b0 
  -0.4249678794331238126098496402574059704734842223340586518754297249b0*%i),
  5.0b-64);
true;

closeto(
  gamma(1.5b0+%i),
  (0.5753151880634517207185443721750111905888222044186561511835535216b0 
  +0.0882106775440939099124646437065074549939338530021656726785327309b0*%i),
  5.0b-64);
true;

closeto(
  gamma(2.5b0+%i),
  (0.7747621045510836711653519145560093308892994536258185540967975514b0 
  +0.7076312043795925855872413377347723730797229839219046602013526179b0*%i),
  5.0b-64);
true;

closeto(
  gamma(3.5b0+%i),
  (1.229274056998116592326138448655250954143525650142641725040641261b0 
  +2.543840115500065135133455258892940263588606913430580204600179096b0*%i),
  5.0b-64);
true;

relerror(
  gamma(75.5b0+%i),
  (-1.092860022497734443706055997676557155572470037327121860702819811b108 
   -2.622326961675321010452173874453854546607804545768376326095021243b108*%i),
  5.0b-64);
true;

(fpprec:oldfpprec,done); /* Reset the value of fpprec */
done;

/******************************************************************************

  Test the Incomplete Gamma function

******************************************************************************/

(oldfpprec : fpprec,done);
done;

/* Some special values */

gamma_incomplete(a,0);
gamma_incomplete(a,0);

(assume(am < 0, ap > 0),done);
done;

errcatch(gamma_incomplete(-1,0));
[];
errcatch(gamma_incomplete(-2,0));
[];
errcatch(gamma_incomplete(am,0));
[];
gamma_incomplete(1,0);
1;
gamma_incomplete(2,0);
1;
gamma_incomplete(3,0);
2;
gamma_incomplete(ap,0);
gamma(ap);

gamma_incomplete(a,inf);
0;

/* Expansion of the Incomplete Gamma function */

gamma_expand:true;
true;

gamma_incomplete(0,z);
-expintegral_ei(-z)+1/2*(log(-z)-log(-1/z))-log(z);

gamma_incomplete(1/2,z);
sqrt(%pi)*erfc(sqrt(z));

gamma_incomplete(-1/2,z);
2*%e^(-z)/sqrt(z)-2*sqrt(%pi)*erfc(sqrt(z));

gamma_incomplete(1,z);
%e^-z;
 
gamma_incomplete(-1,z);
log(z)-(log(-z)-log(-1/z))/2+expintegral_ei(-z)+%e^-z/z;

gamma_incomplete(3/2,z);
sqrt(z)*%e^-z+sqrt(%pi)*erfc(sqrt(z))/2;

gamma_incomplete(-3/2,z);
4*sqrt(%pi)*erfc(sqrt(z))/3-(4*z/3-2/3)*%e^-z/z^(3/2);

gamma_incomplete(2,z);
(z+1)*%e^-z;

gamma_incomplete(a+1,z);
z^a*%e^-z+a*gamma_incomplete(a,z);

gamma_incomplete(a-1,z);
-z^(a-1)*%e^-z/(a-1)-gamma_incomplete(a,z)/(1-a);

gamma_incomplete(a+2,z);
(1-(-a-1)/z)*z^(a+1)*%e^-z+a*(a+1)*gamma_incomplete(a,z);

gamma_incomplete(a-2,z);
gamma_incomplete(a,z)/((1-a)*(2-a))-z^(a-2)*(z/((a-2)*(a-1))+1/(a-2))*%e^-z;

gamma_expand:false;
false;

/* The Incomplete Gamma function has not mirror symmetry on the negative
   real axis. We have supported a conjugate-gamma-incomplete function */

declare(ac, complex, zc,complex);
done;

conjugate(gamma_incomplete(ac,zc));
conjugate(gamma_incomplete(ac,zc));

conjugate(gamma_incomplete(a+b*%i,x+y*%i));
conjugate(gamma_incomplete(a+b*%i,x+y*%i));

conjugate(gamma_incomplete(a+b*%i,10));
gamma_incomplete(a-b*%i,10);

conjugate(gamma_incomplete(a+b*%i,-10));
conjugate(gamma_incomplete(a+b*%i,-10));

/* Numerical tests for the Incomplete Gamma function */

/* At first tests for a=0 and negative integers for a 
   For this values the numerical algorithm of gamma-incomplete do not
   work. The routines of the Exponential Integral E are used. */

closeto(
  gamma_incomplete(0,0.5),
  0.55977359477616081174679593931509b0,
  5e-15);
true;

closeto(
  gamma_incomplete(0,-0.5),
  -0.4542199048631735799205238126628b0-3.1415926535897932384626433832795b0*%i,
  5e-15);
true;

closeto(
  gamma_incomplete(0,0.5+%i),
  -0.07139471104245272355588497993684b0-0.35749377365216265125485869345732b0*%i,
  5e-15);
true;

closeto(
  gamma_incomplete(0,-0.5+%i),
  -0.92289919055678882179364241497461b0-0.81571273343182452677967141350955b0*%i,
  5e-15);
true;

/* Now for bigfloat precision */

fpprec:32;
32;

closeto(
  gamma_incomplete(0,0.5b0),
  0.55977359477616081174679593931509b0,
  1b-30);
true;

closeto(
  gamma_incomplete(0,-0.5b0),
  -0.4542199048631735799205238126628b0-3.1415926535897932384626433832795b0*%i,
  1b-30);
true;

closeto(
  gamma_incomplete(0,0.5b0+%i),
  -0.07139471104245272355588497993684b0-0.35749377365216265125485869345732b0*%i,
  1b-30);
true;

closeto(
  gamma_incomplete(0,-0.5b0+%i),
  -0.92289919055678882179364241497461b0-0.81571273343182452677967141350955b0*%i,
  1b-30);
true;

/* Tests with negative integers */

closeto(
  gamma_incomplete(-1,-0.5),
  -2.8432226365370827137767777629655b0+3.1415926535897932384626433832795b0*%i,
  5e-15);
true;

closeto(
  gamma_incomplete(-5,-0.5),
  -12.1692735494620863710665339515891b0+0.0261799387799149436538553615273b0*%i,
  8e-15);
true;

closeto(
  gamma_incomplete(-1,-0.5+%i),
  -0.54330486022427331058655939975980b0+0.65800685452922697341354545991819b0*%i,
  5e-15);
true;

closeto(
  gamma_incomplete(-5,-0.5+%i),
  0.08881923337904654547301590363812b0+0.18155943299796684573147338017934b0*%i,
  5e-15);
true;

/* Again for bigfloat precision */

closeto(
  gamma_incomplete(-1,-0.5b0),
  -2.8432226365370827137767777629655b0+3.1415926535897932384626433832795b0*%i,
  1b-30);
true;

closeto(
  gamma_incomplete(-5,-0.5b0),
  -12.1692735494620863710665339515891b0+0.0261799387799149436538553615273b0*%i,
  1b-30);
true;

closeto(
  gamma_incomplete(-1,-0.5b0+%i),
  -0.54330486022427331058655939975980b0+0.65800685452922697341354545991819b0*%i,
  1b-30);
true;

closeto(
  gamma_incomplete(-5,-0.5b0+%i),
  0.08881923337904654547301590363812b0+0.18155943299796684573147338017934b0*%i,
  1b-30);
true;

/* Test gamma_incomplete(0.25,2.5) for Float and Bigfloat */

closeto(
  gamma_incomplete(0.25,2.5),
  0.03340545777928488523612480546612030546638337899458717728445920914b0,
  1e-15);
true;

fpprec:32;
32;

closeto(
  gamma_incomplete(0.25b0,2.5b0),
  0.03340545777928488523612480546612030546638337899458717728445920914b0,
  1b-31);
true;

fpprec:64;
64;

closeto(
  gamma_incomplete(0.25b0,2.5b0),
  0.03340545777928488523612480546612030546638337899458717728445920914b0,
  1b-63);
true;

/* Test gamma_incomplete(0.25,0.25) for Float and Bigfloat */

closeto(
  gamma_incomplete(0.25,0.25),
  0.9293237832774184425973508042578251762794944752213875213176435274b0,
  5.0e-15);
true;

fpprec:32;
32;

closeto(
  gamma_incomplete(0.25b0,0.25b0),
  0.9293237832774184425973508042578251762794944752213875213176435274b0,
  1.1b-31);
true;

fpprec:64;
64;

closeto(
  gamma_incomplete(0.25b0,0.25b0),
  0.9293237832774184425973508042578251762794944752213875213176435274b0,
  1.1b-63);
true;

/* Test gamma_incomplete(0.25,0.50) for Float and Bigfloat */

closeto(
  gamma_incomplete(0.25,0.50),
  0.55658041400942713438787175086207b0,
  5.0e-15);
true;

fpprec:32;
32;

closeto(
  gamma_incomplete(0.25b0,0.50b0),
  0.55658041400942713438787175086207b0,
  1b-31);
true;

fpprec:64;
64;

closeto(
  gamma_incomplete(0.25b0,0.50b0),
  0.5565804140094271343878717508620650091658338999776480841533264361b0,
  2b-63);
true;

fpprec:128;
128;

closeto(
  gamma_incomplete(0.25b0,0.50b0),
  0.55658041400942713438787175086206500916583389997764808415332643613122015052649897833312327325822333229784708198027750127190766504b0,  
  1.0b-127);
true;

/* Test gamma_incomplete(0.25,1.50) for Float and Bigfloat */

closeto(
  gamma_incomplete(0.25,1.50),
  0.12115499104033848614860340878369b0,
  1e-15);
true;

fpprec:32;
32;

closeto(
  gamma_incomplete(0.25b0,1.50b0),
  0.12115499104033848614860340878369b0,
  1b-31);
true;

fpprec:64;
64;

closeto(
  gamma_incomplete(0.25b0,1.50b0),
  0.1211549910403384861486034087836891246955052387140720625064500006b0,
  1b-63);
true;

fpprec:128;
128;

closeto(
  gamma_incomplete(0.25b0,1.50b0),
  0.12115499104033848614860340878368912469550523871407206250645000059332022509505923467877887847273887882437030555876962014143410940b0,
  1b-127);
true;

closeto(
  gamma_incomplete(0.25b0,1.50b0),
  1.5b0^0.25b0*expintegral_e(1.0b0-0.25b0,1.50b0),
  1b-128);
true;

fpprec:34; /* Two extra digits to get 32 digits in the following tests */
34;

relerror(
  gamma_incomplete(1000b0,1000b0),
  1.995014933549148239529838438260433407652488769526598301696165147b2564, 
  1b-32);
true;

relerror(
  gamma_incomplete(1000b0,100b0),
  4.023872600770937735437024339230039857193748642107146325437999104b2564,
  1b-32);
true;

relerror(
  gamma_incomplete(1000b0,10b0),
  4.023872600770937735437024339230039857193748642107146325437999104b2564,
  1b-32);
true;

relerror(
  gamma_incomplete(1000b0,1b0),
  4.023872600770937735437024339230039857193748642107146325437999104b2564,
  1b-32);
true;

relerror(
  gamma_incomplete(1000b0,-1b0),
  4.023872600770937735437024339230039857193748642107146325437999104b2564,
  1b-32);
true;

relerror(
  gamma_incomplete(1000b0,-10b0),
  4.023872600770937735437024339230039857193748642107146325437999104b2564,
  1b-32);
true;

relerror(
  gamma_incomplete(1000b0,-100b0),
  4.023872600770937735437024339230039857193748642107146325437999104b2564,
  1b-32);
true;

relerror(
  gamma_incomplete(1000b0,-1000b0),
  -9.852818774470566937423668137175694874333788729537950495924821627b3430,
  1b-32);
true;

relerror(
  gamma_incomplete(100b0,100b0),
  4.542198120862669429369147083086235039624517049342017449058357596b155,
  1b-32);
true;

relerror(
  gamma_incomplete(100b0,10b0),
  9.332621544394415268169923885626670049071596826438162146859296339b155,
  1b-32);
true;

relerror(
  gamma_incomplete(100b0,1b0),
  9.332621544394415268169923885626670049071596826438162146859296390b155,
  1b-32);
true;

relerror(
  gamma_incomplete(100b0,-1b0),
  9.332621544394415268169923885626670049071596826438162146859296390b155,
  1b-32);
true;

relerror(
  gamma_incomplete(100b0,-10b0),
  9.332621544394415268169923885626670049071596826438162126818796880b155,
  1b-32);
true;

relerror(
  gamma_incomplete(100b0,-100b0),
  -1.3474270960118181325667224386845432493096383414519386259680854024b241,
  1b-32);
true;

relerror(
  gamma_incomplete(10.0+10.0*%i,10.0+10.0*%i),
  (712.747910954771249931938579893612285083502899995529160358791610b0 
  -1614.519712336984904341104157868496978481416095290952330318983747b0*%i),
  7.5e-15);
true;

relerror(
  gamma_incomplete(10b0+10b0*%i,10b0+10b0*%i),
  (712.747910954771249931938579893612285083502899995529160358791610b0 
  -1614.519712336984904341104157868496978481416095290952330318983747b0*%i),
  4b-32);
true;

relerror(
  gamma_incomplete(10.0+10*%i,10.0+5*%i),
  (3795.479456353067145208395441052660229834399956460948716792241863b0 
  -1859.399046776284485239753978633491801182777480033526406270435152b0*%i),
  6.0e-15);
true;

relerror(
  gamma_incomplete(10.0b0+10*%i,10.0b0+5*%i),
  (3795.479456353067145208395441052660229834399956460948716792241863b0 
  -1859.399046776284485239753978633491801182777480033526406270435152b0*%i),
  1b-32);
true;

relerror(
  gamma_incomplete(10.0+5*%i,10.0+5*%i),
  (22616.57428441264599471916533645601396385068769401974320192387776b0 
  -41760.26634389514228374497096679850877647381173070930602051580693b0*%i),
  5.0e-15);
true;

relerror(
  gamma_incomplete(10.0b0+5*%i,10.0b0+5*%i),
  (22616.57428441264599471916533645601396385068769401974320192387776b0 
  -41760.26634389514228374497096679850877647381173070930602051580693b0*%i),
  1b-32);
true;

relerror(
  gamma_incomplete(10+5*%i,10+2.5*%i),
  (55884.99767768350551452192526458363894624371018195106017631282130b0 
  -30587.35558698211815103119732529095917842073159139555085583572089b0*%i),
  8.0e-15);
true;

relerror(
  gamma_incomplete(10b0+5*%i,10b0+2.5*%i),
  (55884.99767768350551452192526458363894624371018195106017631282130b0 
  -30587.35558698211815103119732529095917842073159139555085583572089b0*%i),
  1b-32);
true;

relerror(
  gamma_incomplete(10.0+2.5*%i,10.0+2.5*%i),
  (98307.31859173691954817642978681043594336734907098079356276769738b0 
  -69378.82767710646665454093742183442049572498499915146277510648781b0*%i),
  7.0e-15);
true;

relerror(
  gamma_incomplete(10.0b0+2.5*%i,10.0b0+2.5*%i),
  (98307.31859173691954817642978681043594336734907098079356276769738b0 
  -69378.82767710646665454093742183442049572498499915146277510648781b0*%i),
  1b-32);
true;

relerror(
  gamma_incomplete(10.0+2.5*%i,10.0+1.5*%i),
  (119713.97958915216843109406780063078781556428789769599762881675530b0 
  -44021.05551717694140528840726282083152859527358436513276174120234b0*%i),
  9.5e-15);
true;

relerror(
  gamma_incomplete(10.0b0+2.5*%i,10.0b0+1.5*%i),
  (119713.97958915216843109406780063078781556428789769599762881675530b0 
  -44021.05551717694140528840726282083152859527358436513276174120234b0*%i),
  1b-32);
true;

relerror(
  gamma_incomplete(10.0+1.5*%i,10.0+1.5*%i),
  (-143260.5455945276009736506823530548923946268185687353440779787855b0 
  -36427.8601104063533811294405176711748076293661563594190640674077b0*%i),
  5.0e-15);
true;

relerror(
  gamma_incomplete(10.0b0+1.5*%i,10.0b0+1.5*%i),
  (-143260.5455945276009736506823530548923946268185687353440779787855b0 
  -36427.8601104063533811294405176711748076293661563594190640674077b0*%i),
  1b-32);
true;

relerror(
  gamma_incomplete(10.0+1.5*%i,10.0+0.5*%i),
  (-134422.2837349310843015830622649231296922981730868773827217434186b0 
  -76495.4696532860249045908863041952283847028641854696387454419024b0*%i),
  5.0e-15);
true;

relerror(
  gamma_incomplete(10.0b0+1.5*%i,10.0b0+0.5*%i),
  (-134422.2837349310843015830622649231296922981730868773827217434186b0 
  -76495.4696532860249045908863041952283847028641854696387454419024b0*%i),
  1b-32);
true;

relerror(
  gamma_incomplete(10+0.5*%i,10+0.5*%i),
  (70217.4190738045440197722508789471776325390496700488861347101465b0 
  +148228.5649085354026330085827685305718428914334429314381378279173b0*%i),
  6.0e-15);
true;

relerror(
  gamma_incomplete(10b0+0.5*%i,10b0+0.5*%i),
  (70217.4190738045440197722508789471776325390496700488861347101465b0 
  +148228.5649085354026330085827685305718428914334429314381378279173b0*%i),
  1b-32);
true;

relerror(
  gamma_incomplete(5.0+5*%i,5.0+5*%i),
  (-0.4806117328699535298510981197039733622773799503543787399412087606b0 
   +0.8919199556012029365414433316086474496955099800079200844577588174b0*%i),
  5.0e-15);
true;

relerror(
  gamma_incomplete(5.0b0+5*%i,5.0b0+5*%i),
  (-0.4806117328699535298510981197039733622773799503543787399412087606b0 
   +0.8919199556012029365414433316086474496955099800079200844577588174b0*%i),
  1b-32);
true;

relerror(
  gamma_incomplete(5.0+5*%i,5.0+2.5*%i),
  (-1.564618625118515702134408016446776958254116141951281337045968096b0 
   +0.763213115623024892186357289469889653460737525026968402880536542b0*%i),
  5.0e-15);
true;

relerror(
  gamma_incomplete(5.0b0+5*%i,5.0b0+2.5*%i),
  (-1.564618625118515702134408016446776958254116141951281337045968096b0 
   +0.763213115623024892186357289469889653460737525026968402880536542b0*%i),
  1b-32);
true;

relerror(
  gamma_incomplete(5.0+2.5*%i,5.0+2.5*%i),
  (-3.966094476128530812031476427059327525923710898646502835891758741b0 
   -3.843825405733108837026233752472379492035828310495276258481876760b0*%i),
  5.0e-15);
true;

relerror(
  gamma_incomplete(5.0b0+2.5*%i,5.0b0+2.5*%i),
  (-3.966094476128530812031476427059327525923710898646502835891758741b0 
   -3.843825405733108837026233752472379492035828310495276258481876760b0*%i),
  1b-32);
true;

relerror(
  gamma_incomplete(5.0+2.5*%i,5.0-2.5*%i),
  (24.28851242625584709660092800462769890376139980405107830536077980b0
  -13.30717877353455881129062577273028018783505328101266063709140224b0*%i),
  2.0e-15);
true;

relerror(
  gamma_incomplete(5.0b0+2.5*%i,5.0b0-2.5*%i),
  (24.28851242625584709660092800462769890376139980405107830536077980b0
  -13.30717877353455881129062577273028018783505328101266063709140224b0*%i),
  1b-32);
true;

relerror(
  gamma_incomplete(5.0-2.5*%i,5.0-2.5*%i),
  (-3.966094476128530812031476427059327525923710898646502835891758741b0 
   +3.843825405733108837026233752472379492035828310495276258481876760b0*%i),
  5.0e-15);
true;

relerror(
  gamma_incomplete(5.0b0-2.5*%i,5.0b0-2.5*%i),
  (-3.966094476128530812031476427059327525923710898646502835891758741b0 
   +3.843825405733108837026233752472379492035828310495276258481876760b0*%i),
  1b-32);
true;

/******************************************************************************
  Test gamma_incomplete against expintegral_e
******************************************************************************/

block([badpoints : [], 
       ratprint : false,
       abserr : 0,
       maxerr : -1,
       zlimit : 5,
       eps    : 1e-12],
  for a:1 thru 2 step 0.1 do
  (
    for z: -zlimit thru zlimit step 1.0 do
    (
      if is(notequal(z,0.0) and notequal(a,0.0)) then
      (
        zf : float(z),
        af : float(a),
        result : gamma_incomplete(af,zf),
        answer : rectform(zf^af*expintegral_e(1.0-af,zf)),
        abserr : abs(result - answer),
	maxerr : max(maxerr, abserr),
        if abserr > eps then
        (
          badpoints : cons([[a, z], result, answer, abserr], badpoints)
        ) 
      )
    )
  ),
  /* 
   * For debugging, if there are any bad points, return the maximum error 
   * found as the first element.
   */
  if badpoints # [] then
    cons(maxerr, badpoints)
  else
    badpoints
);
[];


/******************************************************************************
  Test Generalized Incomplete Gamma function
******************************************************************************/

/* Some special values */

(kill(a), assume(a>0), done);
done;

gamma_incomplete_generalized(a,z1,0);
gamma_incomplete(a,z1)-gamma(a);

gamma_incomplete_generalized(a,z1,0.0);
gamma_incomplete(a,z1)-gamma(a);

gamma_incomplete_generalized(a,z1,0.0b0);
gamma_incomplete(a,z1)-gamma(a);

gamma_incomplete_generalized(a,0,z2);
gamma(a)- gamma_incomplete(a,z2);

gamma_incomplete_generalized(a,0.0,z2);
gamma(a)- gamma_incomplete(a,z2);

gamma_incomplete_generalized(a,0.0b0,z2);
gamma(a)- gamma_incomplete(a,z2);

gamma_incomplete_generalized(a,z1,inf);
gamma_incomplete(a,z1);

gamma_incomplete_generalized(a,inf,z2);
-gamma_incomplete(a,z2);

gamma_incomplete_generalized(a,0,inf);
gamma(a);

gamma_incomplete_generalized(a,x,x);
0;

gamma_incomplete_generalized(a,1.0,1.0b0);
0;

/* Mirror symmetry, but not when z1 or z2 on the negative real axis */

declare(a,complex, z1,complex, z2, complex);
done;

conjugate(gamma_incomplete_generalized(a,z1,z2));
conjugate(gamma_incomplete_generalized(a,z1,z2));

conjugate(gamma_incomplete_generalized(x+%i*y,1+%i,1-%i));
gamma_incomplete_generalized(x-%i*y,1-%i,1+%i);

(kill(a,z1,z2),done);
done;

/* Test numerical evaluation for some values */

closeto(
  gamma_incomplete_generalized(0.15,0.10,0.90),
  1.285210772938496575538196624140369253496313719924712338486508252b0,
  1e-14);
true;

fpprec:64;
64;

closeto(
  gamma_incomplete_generalized(0.15b0,0.10b0,0.90b0),
  1.285210772938496575538196624140369253496313719924712338486508252b0,
  1b-62);
true;

closeto(
  gamma_incomplete_generalized(0.15+%i,0.10+%i,0.90+%i),
  (-0.03956290928621934869542750861441673192206453223955788892863857789b0 
   -0.13316249485419500645510117515710482169661446536096647384481038655b0*%i),
  1e-14);
true;

closeto(
  gamma_incomplete_generalized(0.15b0+%i,0.10b0+%i,0.90b0+%i),
  (-0.03956290928621934869542750861441673192206453223955788892863857789b0 
   -0.13316249485419500645510117515710482169661446536096647384481038655b0*%i),
  1b-62);
true;

closeto(
  gamma_incomplete_generalized(-0.15+%i,0.10+%i,0.90+%i),
  (-0.07903699552278027449948116754698066920498863638107044857029927559b0 
   -0.10615739775378488990365404098165130400907362070260244159331987806b0*%i),
  1e-14);
true;

closeto(
  gamma_incomplete_generalized(-0.15b0+%i,0.10b0+%i,0.90b0+%i),
  (-0.07903699552278027449948116754698066920498863638107044857029927559b0 
   -0.10615739775378488990365404098165130400907362070260244159331987806b0*%i),
  1b-62);
true;

/******************************************************************************

  Test Regularized Incomplete Gamma function

******************************************************************************/

/* Specialized values */

gamma_incomplete_regularized(a,0);
gamma_incomplete_regularized(a,0);

(assume(ap>0,am<0),done);
done;

errcatch(gamma_incomplete_regularized(am,0));
[];
gamma_incomplete_regularized(ap,0);
1;
gamma_incomplete_regularized(0,z);
0;
gamma_incomplete_regularized(a,inf);
0;

/* Expand gamma_incomplete_regularized */

gamma_expand:true;
true;

gamma_incomplete_regularized(1,z);
%e^(-z);

gamma_incomplete_regularized(a+1,z);
gamma_incomplete_regularized(a,z)+%e^(-z)*z^a/gamma(a+1);

gamma_incomplete_regularized(a-1,z);
gamma_incomplete_regularized(a,z)-%e^(-z)*z^(a-1)/gamma(a);

gamma_incomplete_regularized(1/2,z);
erfc(sqrt(z));
gamma_incomplete_regularized(-1/2,z);
erfc(sqrt(z))-%e^(-z)/sqrt(%pi)/sqrt(z);
gamma_incomplete_regularized(3/2,z);
erfc(sqrt(z))+2*sqrt(z)*%e^(-z)/sqrt(%pi);
gamma_incomplete_regularized(-3/2,z);
erfc(sqrt(z))-3*(4*z/3-2/3)*%e^(-z)/(4*sqrt(%pi)*z^(3/2));

/* Test expansion for half integral values against expansion of 
   gamma_incomplete 
*/

expand(gamma_incomplete_regularized(5/2,z)-gamma_incomplete(5/2,z)/gamma(5/2));
0;
expand(gamma_incomplete_regularized(-5/2,z)-gamma_incomplete(-5/2,z)/gamma(-5/2));
0;
expand(gamma_incomplete_regularized(7/2,z)-gamma_incomplete(7/2,z)/gamma(7/2));
0;
expand(gamma_incomplete_regularized(-7/2,z)-gamma_incomplete(-7/2,z)/gamma(-7/2));
0;
expand(gamma_incomplete_regularized(9/2,z)-gamma_incomplete(9/2,z)/gamma(9/2));
0;
expand(gamma_incomplete_regularized(-9/2,z)-gamma_incomplete(-9/2,z)/gamma(-9/2));
0;

gamma_expand:false;
false;

/* Some numerical tests */

fpprec:64;
64;

closeto(
  gamma_incomplete_regularized(0.25,0.15),
  0.3331718023153566353128831003164180886983644245472471410932121590b0,
  1e-15);
true;

closeto(
  gamma_incomplete_regularized(0.25b0,0.15b0),
  0.3331718023153566353128831003164180886983644245472471410932121590b0,
  1b-62);
true;

closeto(
  gamma_incomplete_regularized(-0.25,0.15),
   -0.3747953569677745583399657181155178573572870781780605755597341785b0,
  1e-15);
true;

closeto(
  gamma_incomplete_regularized(-0.25b0,0.15b0),
   -0.3747953569677745583399657181155178573572870781780605755597341785b0,
  1b-61);
true;

closeto(
  gamma_incomplete_regularized(-0.25,-0.15),
  (0.1206888313473692669850487605186163406801228067412581029970643626b0 
  +0.8793111686526307330149512394813836593198771932587418970029356374b0*%i),
  1e-15);
true;

closeto(
  gamma_incomplete_regularized(-0.25b0,-0.15b0),
  (0.1206888313473692669850487605186163406801228067412581029970643626b0 
  +0.8793111686526307330149512394813836593198771932587418970029356374b0*%i),
  1e-15);
true;

closeto(
  gamma_incomplete_regularized(0.25,0.15+%i),
  (-0.0241833450538703040924257417951024895368614341619005659619193200b0 
   -0.1759768209797086273285777898669237251900625192446301525551431309b0*%i),
  1e-15);
true;

closeto(
  gamma_incomplete_regularized(0.25b0,0.15b0+%i),
  (-0.0241833450538703040924257417951024895368614341619005659619193200b0 
   -0.1759768209797086273285777898669237251900625192446301525551431309b0*%i),
  1b-62);
true;

closeto(
  gamma_incomplete_regularized(0.25,0.15-%i),
  (-0.0241833450538703040924257417951024895368614341619005659619193200b0 
   +0.1759768209797086273285777898669237251900625192446301525551431309b0*%i),
  1e-15);
true;

closeto(
  gamma_incomplete_regularized(0.25b0,0.15b0-%i),
  (-0.0241833450538703040924257417951024895368614341619005659619193200b0 
   +0.1759768209797086273285777898669237251900625192446301525551431309b0*%i),
  1b-62);
true;

/******************************************************************************
  Test the Error functions: erf, erfc, erfi and erf_generalized
******************************************************************************/

/* Specific values */

map(erf, [0,0.0,0.0b0,inf,minf,infinity,und,ind]);
[0,0.0,0.0b0,1,-1,erf(infinity),erf(und),erf(ind)];

map(erfc, [0,inf,minf,infinity,und,ind]);
[1,0,2,erfc(infinity),erfc(und),erfc(ind)];

map(erfi, [0,inf,minf,infinity,und,ind]);
[0,inf,minf,erfi(infinity),erfi(und),erfi(ind)];

erf_generalized(z1,0);
-erf(z1);

erf_generalized(0,z2);
erf(z2);

erf_generalized(0,0);
0;

erf_generalized(0.0,0.0);
0;

erf_generalized(0.0b0,0.0b0);
0;

erf_generalized(z1,inf);
1-erf(z1);

erf_generalized(z1,minf);
-erf(z1)-1;

erf_generalized(inf,z2);
erf(z2)-1;

erf_generalized(minf,z2);
erf(z2)+1;

/* Parity */

erf(-z);
-erf(z);

erfc(-z);
2-erfc(z);

erfi(-z);
-erfi(z);

erf_generalized(-z1,-z2);
-erf_generalized(z1,z2);

/* Mirror symmetrie */

declare(z,complex);
done;

conjugate(erf(z));
erf(conjugate(z));

conjugate(erf(x+%i*y));
erf(x-%i*y);

conjugate(erfc(z));
erfc(conjugate(z));

conjugate(erfc(x+%i*y));
erfc(x-%i*y);

conjugate(erfi(z));
erfi(conjugate(z));

conjugate(erfi(x+%i*y));
erfi(x-%i*y);

declare(z1,complex,z2,complex);
done;

conjugate(erf_generalized(z1,z2));
erf_generalized(conjugate(z1),conjugate(z2));

conjugate(erf_generalized(x1+%i*y1,x2+%i*y2));
erf_generalized(x1-%i*y1,x2-%i*y2);

/* Numerical test for the Error functions 
   First check erf in double float precision */

closeto(
  erf(-0.50),
  -0.5204998778130465376827466538919645287364515757579637000588057256b0,
  1e-15);
true;

closeto(
  erf(0.50),
  0.5204998778130465376827466538919645287364515757579637000588057256b0,
  1e-15);
true;

closeto(
  erf(0.75),
  0.7111556336535151315989378345914107773742059540965372322781333971b0,
  1e-15);
true;

closeto(
  erf(-0.75+%i),
  (-1.372897192365736489613456241111589390954675856186764729607156305b0 
  + 0.539788632227100129936591912063260716699852732091113612337142798b0*%i),
  1e-15);
true;

closeto(
  erf(-0.50+%i),
  (-1.204847558314218002702112682097006717296399718277162764595960866b0 
  + 1.024400881608445881724860454410886676966127193189877583791256132b0*%i),
  1e-15);
true;

closeto(
  erf(0.50+%i),
  ( 1.204847558314218002702112682097006717296399718277162764595960866b0 
  + 1.024400881608445881724860454410886676966127193189877583791256132b0*%i),
  1e-15);
true;

closeto(
  erf(0.75+%i),
  ( 1.372897192365736489613456241111589390954675856186764729607156305b0 
  + 0.539788632227100129936591912063260716699852732091113612337142798b0*%i),
  1e-15);
true;

/* Erf with bigfloat precision */

fpprec:64;
64;

closeto(
  erf(-0.50b0),
  -0.5204998778130465376827466538919645287364515757579637000588057256b0,
  1b-61);
true;

closeto(
  erf(0.50b0),
  0.5204998778130465376827466538919645287364515757579637000588057256b0,
  1b-61);
true;

closeto(
  erf(0.75b0),
  0.7111556336535151315989378345914107773742059540965372322781333971b0,
  1b-61);
true;

closeto(
  erf(-0.75b0+%i),
  (-1.372897192365736489613456241111589390954675856186764729607156305b0 
  + 0.539788632227100129936591912063260716699852732091113612337142798b0*%i),
  1b-61);
true;

closeto(
  erf(-0.50b0+%i),
  (-1.204847558314218002702112682097006717296399718277162764595960866b0 
  + 1.024400881608445881724860454410886676966127193189877583791256132b0*%i),
  1b-61);
true;

closeto(
  erf(0.50b0+%i),
  ( 1.204847558314218002702112682097006717296399718277162764595960866b0 
  + 1.024400881608445881724860454410886676966127193189877583791256132b0*%i),
  1b-61);
true;

closeto(
  erf(0.75b0+%i),
  ( 1.372897192365736489613456241111589390954675856186764729607156305b0 
  + 0.539788632227100129936591912063260716699852732091113612337142798b0*%i),
  1b-61);
true;

/* We have done a check for the numerical algorithm of the Erf function which
   calls the Incomplete Gamma function. 
   We do not do further numerical tests for the other Error functions, 
   but only check the correct implementation of the numercial routines
   against the Erf function
*/

/* Check Erfc against Erf for some values */

fpprec:32;
32;

closeto(
  erfc(-0.25),
  1-erf(-0.25),
  1e-15);
true;

closeto(
  erfc(0.25),
  1-erf(0.25),
  1e-15);
true;

closeto(
  erfc(-0.25+%i),
  1-erf(-0.25+%i),
  1e-15);
true;

closeto(
  erfc(0.25+%i),
  1-erf(0.25+%i),
  1e-15);
true;

closeto(
  erfc(-0.25b0),
  1-erf(-0.25b0),
  1.0b-30);
true;

closeto(
  erfc(0.25b0),
  1-erf(0.25b0),
  1b-30);
true;

closeto(
  erfc(-0.25b0+%i),
  1-erf(-0.25b0+%i),
  1b-30);
true;

closeto(
  erfc(0.25b0+%i),
  1-erf(0.25b0+%i),
  1b-30);
true;

/* Check Erfi against Erf for some values */

closeto(
  erfi(-0.15),
  -%i*erf(-0.15*%i),
  1e-15);
true;

closeto(
  erfi(0.15),
  -%i*erf(0.15*%i),
  1e-15);
true;

closeto(
  erfi(-0.15+%i),
  -%i*erf((-0.15+%i)*%i),
  1e-15);
true;

closeto(
  erfi(0.15+%i),
  -%i*erf((0.15+%i)*%i),
  1e-15);
true;

closeto(
  erfi(-0.15b0),
  -%i*erf(-0.15b0*%i),
  5.0b-30);
true;

closeto(
  erfi(0.15b0),
  -%i*erf(0.15b0*%i),
  5.0b-30);
true;

closeto(
  erfi(-0.15b0+%i),
  expand(-%i*erf((-0.15b0+%i)*%i)),
  1b-30);
true;

closeto(
  erfi(0.15b0+%i),
  expand(-%i*erf((0.15b0+%i)*%i)),
  1b-30);
true;

/* Check Generalized Erf against Erf for some values */

closeto(
  erf_generalized(0.35,1.25),
  erf(1.25)-erf(0.35),
  1e-15);
true;

closeto(
  erf_generalized(0.35+%i,1.25),
  erf(1.25)-erf(0.35+%i),
  1e-15);
true;

closeto(
  erf_generalized(0.35,1.25+%i),
  erf(1.25+%i)-erf(0.35),
  1e-15);
true;

closeto(
  erf_generalized(0.35+%i,1.25+%i),
  erf(1.25+%i)-erf(0.35+%i),
  1e-15);
true;

closeto(
  erf_generalized(0.35b0,1.25b0),
  erf(1.25b0)-erf(0.35b0),
  1b-30);
true;

closeto(
  erf_generalized(0.35b0+%i,1.25b0),
  erf(1.25b0)-erf(0.35b0+%i),
  1b-30);
true;

closeto(
  erf_generalized(0.35b0,1.25b0+%i),
  erf(1.25b0+%i)-erf(0.35b0),
  1b-30);
true;

closeto(
  erf_generalized(0.35b0+%i,1.25b0+%i),
  erf(1.25b0+%i)-erf(0.35b0+%i),
  1b-30);
true;

(fpprec:oldfpprec,done);
done;
